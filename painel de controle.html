<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Simples</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="painel">
    <label for="tema-select">Tema:</label>
    <select id="tema-select">
      <option value="padrao">Padrão</option>
      <option value="novosentido">Novo Sentido</option>
      <option value="semanadeoracao">Semana de Oração</option>
    </select>
  </div>

  <!--<div class="painel">
    Cabeçalho com switch e título --
    <div class="painel-header">
      <h2 class="painel-titulo">Modelo Simples</h2>
      <label class="switch">
        <input type="checkbox" id="painel-switch">
        <span class="slider"></span>
      </label>
    </div>-->

    <!-- Campos de entrada --
    <div class="painel-body">
      <label for="nome"></label>
      <input type="text" id="nome" placeholder="Nome">

      !-- <label for="info">Info</label> --
      <input type="text" id="info" placeholder="Info">
    </div>
  </div>-->

  <div class="painel">
    <div class="painel-header">
      <h2 class="painel-titulo">Transmissão</h2>
      <label class="switch">
        <input type="checkbox" id="painel-switch2">
        <span class="slider"></span>
      </label>
    </div>
    <div class="painel-body">
      <label for="nome2"></label>
      <input type="text" id="nome2" placeholder="Nome">
      <input type="text" id="info2" placeholder="Info">
    </div>
    <div class="painel-botoes">
      <button class="botao-salvo" data-slot="1">1</button>
      <button class="botao-salvo" data-slot="2">2</button>
      <button class="botao-salvo" data-slot="3">3</button>
      <button class="botao-salvo" data-slot="4">4</button>
      <button class="botao-salvo" data-slot="5">5</button>
      <button class="botao-salvo" data-slot="6">6</button>
      <button class="botao-salvo" data-slot="7">7</button>
      <button class="botao-salvo" data-slot="8">8</button>
    </div>
  </div>
  
<!---->
  <!--
  <div class="painel">
    <div class="painel-header">
      <h2 class="painel-titulo">Instagram</h2>
      <label class="switch">
        <input type="checkbox" id="switch-insta">
        <span class="slider"></span>
      </label>
    </div>
    <div class="painel-body">
      <label for="nome3"></label>
      <input type="text" id="nome3" placeholder="@Instagram">
    </div>
  </div>
  -->
  
  <!--
  <div class="painel">
    <div class="painel-header">
      <h2 class="painel-titulo">QR code</h2>
      <label class="switch">
        <input type="checkbox" id="painel-switch4">
        <span class="slider"></span>
      </label>
    </div>
    <div class="painel-body">
      <input type="text" id="nome4" placeholder="Descrição">
      <input type="file" id="qrcode-img" accept="image/*">
    </div>
  </div>
  -->

  <div class="painel">
    <label for="notes" style="margin-bottom:5px">Notas</label><br>
    <textarea id="notes" rows="6"></textarea>
  </div>



</body>

<script>
  // Cria o canal de broadcast
  const canal = new BroadcastChannel('painel_exibicao');

  /*
  // Switch Instagram (comentado)
  const instaSwitch = document.getElementById('switch-insta');
  instaSwitch.addEventListener('change', function() {
    if (instaSwitch.checked) {
      canal.postMessage({ acao: 'mostrarBarra' });
      setTimeout(() => {
         instaSwitch.checked = false;
         canal.postMessage({ acao: 'esconderBarra' });
       }, 15000);
    } else {
      canal.postMessage({ acao: 'esconderBarra' });
    }
  });
  */
  /*
  // QR Code - Enviar imagem e descrição (comentado)
  const qrInput = document.getElementById('qrcode-img');

  qrInput.addEventListener('change', function() {
    const file = qrInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        canal.postMessage({
          acao: 'atualizarQR',
          imagem: e.target.result
        });
      };
      reader.readAsDataURL(file);
    }
  });

  // Switch do QR (comentado)
  const qrSwitch = document.getElementById('painel-switch4');
  qrSwitch.addEventListener('change', function() {
    if (qrSwitch.checked) {
      canal.postMessage({ acao: 'mostrarQR' });
    } else {
      canal.postMessage({ acao: 'esconderQR' });
    }
  });
  */

  const sentidoSwitch = document.getElementById('painel-switch2');
  const nome2 = document.getElementById('nome2');
  const info2 = document.getElementById('info2');

  // Desliga automático após 8 segundos quando ativado
  let sentidoAutoOffTimer = null;
  sentidoSwitch.addEventListener('change', function() {
    // se ligado, mostra e programa desligamento
    if (sentidoSwitch.checked) {
      canal.postMessage({
        acao: 'mostrarLowerthird',
        nome: nome2.value,
        info: info2.value
      });

      // limpa timer anterior (evita múltiplos)
      if (sentidoAutoOffTimer) {
        clearTimeout(sentidoAutoOffTimer);
      }
      sentidoAutoOffTimer = setTimeout(() => {
        sentidoSwitch.checked = false;
        canal.postMessage({ acao: 'esconderLowerthird' });
        sentidoAutoOffTimer = null;
      }, 8000); // 8000 ms = 8 segundos

    } else {
      // se desligou manualmente, cancela timer e esconde
      if (sentidoAutoOffTimer) {
        clearTimeout(sentidoAutoOffTimer);
        sentidoAutoOffTimer = null;
      }
      canal.postMessage({ acao: 'esconderLowerthird' });
    }
  });

  // Se quiser atualizar em tempo real ao digitar:
  nome2.addEventListener('input', function() {
    if (sentidoSwitch.checked) {
      canal.postMessage({
        acao: 'mostrarLowerthird',
        nome: nome2.value,
        info: info2.value
      });
    }
  });
  info2.addEventListener('input', function() {
    if (sentidoSwitch.checked) {
      canal.postMessage({
        acao: 'mostrarLowerthird',
        nome: nome2.value,
        info: info2.value
      });
    }
  });

  const temaSelect = document.getElementById('tema-select');
  temaSelect.addEventListener('change', function() {
    canal.postMessage({ acao: 'alterarTema', tema: temaSelect.value });
  });

  // --- Gerenciamento simples de "variáveis" por botão (1..8) ---
  // Cada slot guarda { nome, info } em memória e também em localStorage (para persistir entre sessões).
  const slots = {};
  for (let i = 1; i <= 8; i++) {
    const raw = localStorage.getItem(`slot_${i}`);
    slots[i] = raw ? JSON.parse(raw) : { nome: '', info: '' };
  }

  let activeSlot = null;
  const botaoSlots = document.querySelectorAll('.botao-salvo');

  // atualiza o title (tooltip) de todos os botões com o nome salvo (ou "Vazio")
  function updateButtonTitles() {
    botaoSlots.forEach(b => {
      const slot = b.getAttribute('data-slot');
      const data = slots[slot] || { nome: '', info: '' };
      b.title = data.nome ? data.nome : 'Vazio';
    });
  }

  function setActiveButton(slot) {
    activeSlot = String(slot);
    // atualiza classe visual
    botaoSlots.forEach(b => b.classList.toggle('ativo', b.getAttribute('data-slot') === activeSlot));
    // carregar valores da "variável" para os campos
    nome2.value = slots[activeSlot].nome || '';
    info2.value = slots[activeSlot].info || '';
    // persistir qual slot está ativo
    localStorage.setItem('active_slot', activeSlot);
    // atualizar tooltips (caso tenham mudado)
    updateButtonTitles();
  }

  // ao clicar em um botão numerado, torna-o ativo e carrega seus valores
  botaoSlots.forEach(b => {
    const slot = b.getAttribute('data-slot');
    b.addEventListener('click', () => {
      setActiveButton(slot);
    });
  });

  // atualiza a variável do slot ativo sempre que os campos forem editados
  function updateActiveSlotFromFields() {
    if (!activeSlot) return;
    slots[activeSlot].nome = nome2.value;
    slots[activeSlot].info = info2.value;
    // salva no localStorage para persistência
    localStorage.setItem(`slot_${activeSlot}`, JSON.stringify(slots[activeSlot]));
    // atualizar tooltip do botão ativo
    const btn = document.querySelector(`.botao-salvo[data-slot="${activeSlot}"]`);
    if (btn) btn.title = slots[activeSlot].nome ? slots[activeSlot].nome : 'Vazio';
  }

  nome2.addEventListener('input', updateActiveSlotFromFields);
  info2.addEventListener('input', updateActiveSlotFromFields);

  // ao carregar a página, atualiza títulos e reaplica o slot ativo salvo (se houver)
  updateButtonTitles();
  const persistedActive = localStorage.getItem('active_slot');
  if (persistedActive && slots[persistedActive]) {
    setActiveButton(persistedActive);
  }
  
</script>

@https.victor073 

</html>
